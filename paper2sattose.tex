\documentclass[a4paper]{article}
\usepackage{graphicx}
\usepackage{twocolceurws}
\usepackage{xcolor}
\usepackage{url}

\def\infinity{\rotatebox{90}{8}}


\title{[Artifact Presentation] Damegender: \\ Writing and Comparing Gender Detection Tools}

\author{
David Arroyo Men\'endez, Jesus Gonzalez-Barahona \\ Grupo de Sistemas y Comunicaciones (GSyC) \\ Universidad Rey Juan Carlos, Madrid, Spain \\ \{d.arroyome@alumnos, jgb@gsyc\}.urjc.es
%\and
%Jesus Gonzalez-Barahona \\ GSyC \\ Universidad Rey Juan Carlos \\ jgb@gsyc.es
}


\newif\ifdraft
\drafttrue
%\draftfalse
\input{macros}


\institution{}


\begin{document}
\maketitle

\begin{abstract}
%Context
Diversity in software development teams have been identified as one of the main ingredients of a more productive, more healthy software community.
Thus, the interest of the research community in identifying who is contributing has increased in the last years.
In the software domain, and although other types of diversity exist, this is especially important for the case of gender.
% Objective, 
Given the large amount of publicly available data on the software development process that can be retrieved and analyzed from the Internet (e.g., GitHub, StackOverflow), the importance of having methods and tools that help with large amounts of data would be desirable.
% Method
In this paper we present a free software tool, called \texttt{namegender}, which we have conceived to given a name (and optionally some additional data such as geographic information) outputs the gender.
\texttt{damegender} is based on open databases from official census and uses Machine Learning to guess diminutives or nicknames.
% Results 
We have compared \texttt{damegender} with other existing gender guesser APIs, obtaining good results.
% Conclusions.

\end{abstract}


\section{Introduction}

In recent times, many research investigations have been made on gender
diversity in the IT domain.
Examples of these efforts range from participation in Twitter~\cite{burger2011discriminating,mislove2011understanding},
in Wikipedia ~\cite{antin2011gender,hill2013wikipedia}, in science~\cite{holman2018gender,dollar1999gender}, and more specifically in the software domain in StackOverflow~\cite{vasilescu2012gender}, GitHub~\cite{vasilescu2015gender} and in Free/Libre/Open Source Software development~\cite{robles2014floss}.
The interest on gender diversity is become more and more relevant, and so does the identification methods that allow to perform comprehensive studies on gender representation in different domains, given the large amounts of data available, in particular from collaborative environments.

There are different ways to detect gender from a person name and perhaps a surname.
A first, more rudimentary, is based on data extracted from the census, Wikipedia, self-references in trust websites, searches in Google Images, among others.
Another way to do it is by using one of the existing Application Programming Interfaces (APIs).
This paper is about the latter, about their possibilities and limitations.
Therefore, (i) we evaluate the quality and price of different commercial solutions;
(ii) we discuss about solutions using free licenses;
(iii) we investigate what happens with those names without census, for example, nicknames or diminutives; and
(iv) we elaborate on how massive gender detection from Internet, for example, mailing
  lists or software repositories, can be done.

As a result, we contribute with: 
(i) an evaluation of the quality of different solutions applying well-known metrics;
(ii) a tool, called \texttt{damegender}, guessing gender from a name giving support to Spanish and
  English from the open data census provides by the states built to understand 
  current technologies in detail;
(iii) a machine learning solution to strings not found in the
  census dataset to approach the problem with nicknames and diminutives; and 
(iv) a proof-of-concept of \texttt{damegender} to detect
  gender in mailing lists and software repositories.


%A summary of current features of \texttt{damegender} are:
%
%\begin{itemize}
%  \item To deduce the gender about a name in Spanish or English (current status) from open census in local.
%  \item To decide about males and females in strings using different machine learning algorithms.
%  \item To use the main solutions in gender detection (genderize, genderapi, namsor, nameapi and gender guesser) from a command.
%  \item To research about why a name is related to males or females with   statistics. We provide Python commands about study and compare gender solutions with: confusion matrix, accuracies, error measures. And to decide about features: statistical feature weight, principal component analysis, ...
%  \item To determine gender gap in free software repositories or mailing lists (proof of concept)
%\end{itemize}


\grex{The remainder of this paper is structured as follows...}


\section{Damegender}

\texttt{damegender}\footnote{https://github.com/davidam/damegender} is a gender detection tool under a free software license (in particular, the GNU General Public License v3.0). 
It has been implemented in Python to take advantage of many other free software tools used in the scientific domain, such as the Natural Language Toolkit (NLT) for Natural Language Processing~\cite{loper2002nltk}, Scikit for Machine Learning~\cite{pedregosa2011scikit}, Numpy for Numerical Computation~\cite{van2011numpy}, and Matplotlib to visualize results~\cite{hunter2007matplotlib}. 
At its current point it is linked to Perceval~\cite{duenas2018perceval}, a tool specialized in retrieving and gathering data from software repositories, such as git and mailing lists.

The software is using an oriented to objects design with unit testing for classes and methods using nose and unit testing for Python commands using Bash. 
\texttt{damegender} is a Python package that can be installed using PIP (the package installer for Python) from the console.

The main reason for developing \texttt{damegender} is that there are not many free software tools that help in the identification of gender. Before \texttt{damegender}, only \texttt{Gender guesser}\footnote{https://github.com/lead-ratings/gender-guesser} offered a free software solution in this field~\cite{krawetz2006gender}, and the project has not been active for more than three years now.
The best contribution of \texttt{Gender guesser} is the dataset containing 48,528 names with a good classification by countries\footnote{\url{https://raw.githubusercontent.com/lead-ratings/gender-guesser/master/gender_guesser/data/nam_dict.txt}}.

\subsection{Datasets}

Gender guesser tools apply several methods for estimating the gender from a given name. 
As a starting point, however, all of them rely on a dataset that contains information on what gender a name usually can be attributed to.

There are several sources to create a databases, being the most common:  
(1) a census published with a free license (open census way), 
(2) a dataset released with a free license in a free software package (free software way), 
(3) a dataset retrieved from commercial APIs (commercial API way), and
(4) a dataset which is the result of an investigation and that has been released publicly (scientific way).

In \texttt{damegender}, we are including Open Data census about names and gender, from institutions such as INE.es (the Spanish National Statistics Institute), or the governments of Uruguay, USA and United Kingdom.
%We want datasets provided by the software package to increment the speed retrieving data.
Some Open Datasets, such the one offered by INE.es or the government of the United States of America offer support for surnames and how they are related to ethnicity. 
In particular, the dataset from the government of the United States of America offers a probability of the race, and the Spanish INE.es gives the number of people with a surname with a nationality different to the Spanish nationality.

Hence, we are using the census approach as base of truth to distinguish if a name is male or female in a geographical area. 
Generally, a name has a strong weight to determine if it is a male or a female on this way.
For instance, David is registered 365,196 times as male, but 0 times as female in the data offered by the Spain National Institute of Statistics.
There are names that heavily depend on the region. 
For instance, Andrea would be considered a female name in Germany, but a male name in Italy.
However, many countries do not provide Open Data census about gender and names.

%From the user final point of view, the value of using Open Data is to give a good explanation when we are asking about the gender from a name (number of males and females using a specific name in a country) versus a probability created by the way explained in~\cite{10.7717/peerj-cs.156} or similar.

%From the scientific point of view, the value of using Open Data is to allow that the experiment can be reviewed by peers on an automatic and legal way (using proprietary data the reviewer should request it separately to make the review).

%A second approach is to build the dataset reviewing the names in scientific personal sites, Wikipedia, ... ~\cite{10.7717/peerj-cs.156}. 
%This approach is valid, but it consumes many time and efforts, although could be useful if there not a legal way to build the dataset.

We have evaluated to include data from the second option (datasets released with a free license). 
For instance, Natural Language Tool Kit offers 8,000 labeled English names classified as male or female. 
Another example is Gender Guesser a good dataset for international names with different categories to define the probability. 
The problem with these data is that we have observed that they do not have the quality of National Statistics Institutes. 

%This approach is similar to use a dataset released with a paper in a journal, the advantage is to understand and add new names with a solid criteria accepted by the scientific community.

The third approach is based on the trust on commercial solutions, in the same way we trust search engines when we make searches in Internet.
This is because commercial APIs can be seen just a black box, so we do not know where the data comes from and how it has been treated.
As at this point, commercial APIs offer better results as other solutions, \texttt{damegender} gives the possibility to include data from them.
Thus, it is possible to download JSON files from the main commercial gender guesser API solutions (e.g., \texttt{genderapi}, \texttt{genderize}, \texttt{namsor}, \texttt{nameapi}) and use it as the dataset.
There are certain uses that are currenly only available in such tools.

% One user can build proprietary datasets on this way using an average weighted by the precision or accuracy of each Application Programming Interface measured with \texttt{damegender} with an open dataset as base of truth.

As a final goal, we envision to build a free dataset with names and gender, that builds on top of \texttt{Gender Guesser} and that can be made available as Wikidata. 
Perhaps, to complete this work, we need to combine an automated with a manual process as described in~\cite{10.7717/peerj-cs.156}.

\begin{table*}[ht]
\footnotesize
\begin{tabular}[]{lcccccc}
\hline
Service / Tool $->$ & Gender API & gender-guesser & genderize.io & NameAPI & NamSor & damegender\tabularnewline
\hline
Database size & 431M & 45K & 114M & 1M & 4G & 57K \tabularnewline
Regular data updates & Yes & no & No & Yes & Yes & Yes\tabularnewline
Unstructured full name strings & Yes & No & No & Yes & No & Yes\tabularnewline
Surnames & Yes & No & No & Yes & Yes & Yes\tabularnewline
Non-Latin alphabets & Partial & No & Partial & Yes & Yes & No\tabularnewline
Implicit geo-localization & Yes & No & No & Yes & Yes & No\tabularnewline
Exists locale & Yes & Yes & Yes & Yes & Yes & Yes\tabularnewline
Assingment type & P & B & P & P & P & P \tabularnewline
Free parameters & T,P & G & P,C & T & S & T,C\tabularnewline
Prediction & No & No & No & No & No & Yes\tabularnewline
Free license & No & Yes & No & No & No & Yes\tabularnewline
REST API & Yes & No & Yes & Yes & Yes & Planned\tabularnewline
Limits number of requests & Yes (200) & \infinity & Yes & Yes & Yes & \infinity \tabularnewline
\hline
\end{tabular}
\caption{Comparison of the different features that gender guesser software services and tools offer. Assignment type = \{P: Probabilistic; B: Binary\}. Free Parameters = \{T: total\_names; P: probability; C: count; G: gender; T: trust; S: scale \}. \grex{Estaria bien contar con ``the monthly subscription cost (calculated for 100,000 requests/month)'' en la tabla, porque daría más info muy relevante.} }
\label{table:comparison}
\end{table*}

\section{Feature comparison with other tools}

Standard commercial Application Programming Interfaces (APIs) usually guess the gender for a single name or a list of names (from a CSV file or an API call). 
To express geolocalization the user can also give surnames, a country ISO code, or specify a language.
Generally, you can give a probability and a counter associated to a name and gender in a certain population.

Santamara and Mihaljevi~\cite{10.7717/peerj-cs.156} offer a framework to classify gender tools.
The features observed in this framework are: (i) database size (as of January 2018), (ii) if there are regular data updates, (iii) if they handle unstructured full name strings, (iv) if they handle surnames, (v) if they handle non-Latin alphabets, (vi) if implicit geolocalization is available, (vii) if locale exists, (viii) the type of assignment, (ix) if free parameters are possible, (x) if they offer prediction, (xi) if the tool is released under an open source license, (xii) if they offer an API, (xiii) the amount of monthly free requests, and (xiv) the monthly subscription cost (calculated for 100,000 requests/month)).

We have used this comparison framework and have extended it with other tools, including \texttt{damegender} and updated it to today.
Results can be found in Table~\ref{table:comparison}.



\section{Reproducing accuracies and confusion matrix}

There are different ways to express the probability of a successful identification (e.g., confidence, scale, accuracy, precision, recall).
We se the confusion matrix to understand where the different tools suceed or fail, and to analyze the different errors measures (error coded, error coded without not applicable values, error gender bias, not applicable coded) that appear.

Santamara and Mihaljevi~\cite{10.7717/peerj-cs.156} explain different ways to determine gender from a name by humans and offers 7,000 names applying these methods. 
In their dataset, gender is classified as male, female or unknown. 
We have used this dataset, not considering the unknow variable, for our experiments.
The results can be seen in Table~\ref{table:DifferentAccuraciesMeasures}.
As can be observed, Genderapi and Genderize are obtaining the best results, although all solutions reach results better than 0.8, except for \texttt{Gender Guesser}.

\grex{Deberiamos explicar que es cada una de las metricas. Y tambien por que tenemos 1.0 de recall en todos los casos.}


%\begin{table*}[]{@{}lllllll@{}}
\begin{table}
\footnotesize
\begin{tabular}[]{lcccc}
  \hline
  API & Acc & Prec & F1 & Recall\tabularnewline
\hline
Genderapi & 0.969 & 0.972 & 0.964 & 1.0\tabularnewline
Genderize & 0.927 & 0.976 & 0.966 & 1.0\tabularnewline
Damegender (SVC)\footnote{SVC is the acronym of Support Vector Classification, the Machine Learning algorithm that Damegender was using with this results} & 0.879 & 0.972 & 0.972 & 1.0\tabularnewline
Namsor & 0.867 & 0.973 & 0.924 & 1.0\tabularnewline
Nameapi & 0.830 & 0.974 & 0.905 & 1.0\tabularnewline
Gender Guesser & 0.774 & 0.985 & 0.872 & 1.0\tabularnewline
\hline
\end{tabular}
\caption{Different accuracies measures}
\label{table:DifferentAccuraciesMeasures}
\end{table}

We have performed a comparison using a confusion matrix for the software/tools (see Table~\ref{table:ConfusionMatrixTables}).
Compared to the results obtained in~\cite{10.7717/peerj-cs.156}, we can see that they are very similar.
The most important tools (\texttt{Namsor}, \texttt{Genderapi} and \texttt{Genderize}) are improving the accuracies with respect the previous comparison.
In particular, \texttt{Genderapi} has similar results, but it improves the results for \emph{undefined}.
In \texttt{Genderguesser} we obtain different results, which is to some extent not expected, because the software has not modified for several years.
For \texttt{Genderize}, we obtain the same results. 
\texttt{Nameapi}'s results is changing from male to female with more errors. 
In \texttt{Namsor}, the results are similar. 
\texttt{damegender} is not guessing undefined because we predict with machine learning (SVC) if the string is not in the database.

\begin{table}
\footnotesize
\begin{tabular}[]{lrrrr}
  \hline
  APIs          & gender & male & female & undef \tabularnewline
\hline
%%\endhead
Genderapi         & male    & 3589 & 155  &  67 \tabularnewline
                  & female  & 211  & 1734 &  23 \tabularnewline
Damegender       & male    & 3663 & 147  &   0 \tabularnewline
(SVC)\footnotemark[1] & female  & 551  & 1497 &   0 \tabularnewline
Genderguesser     & male    & 3326 &  139 & 346 \tabularnewline
                  & female  & 78   & 1686 & 204 \tabularnewline
Namsor            & male    & 3325 & 139  & 346 \tabularnewline
                  & female  & 78   & 1686 & 204 \tabularnewline
Genderize         & male    & 3157 & 242  & 412 \tabularnewline
                  & female  & 75   & 1742 & 151 \tabularnewline
Nameapi           & male    & 2627 & 674  & 507 \tabularnewline
                  & female  & 667  & 1061 & 240 \tabularnewline 
\hline
\end{tabular}
\caption{Confusion matrix tables by APIs}
\label{table:ConfusionMatrixTables}
\end{table}


In Table~\ref{table:ApisAndErrors} we can observe a high index of errors in \texttt{Nameapi} and \texttt{Namsor} and a low index of errors in \texttt{GenderApi} and \texttt{damegender}.

\grex{Aqui haria falta indicar por que hacemos esta comparacion y que queremos aprender de ella}

\begin{table*}
\footnotesize
\begin{tabular}[]{lrrrr}
\hline
API & error & error w/o na & na coded & error gender bias\tabularnewline
\hline
%\endhead
Damegender (SVC)\footnotemark[1] & 0.121 & 0.121 & 0.0 & -0.07\tabularnewline
GenderApi & 0.167 & 0.167 & 0.0 & -0.167\tabularnewline
Gender Guesser & 0.225 & 0.027 & 0.204 & 0.003\tabularnewline
Genderize & 0.276 & 0.261 & 0.0204 & -0.0084 \tabularnewline 
Namsor & 0.332 & 0.262 & 0.095 & 0.01 \tabularnewline
Nameapi & 0.361 & 0.267 & 0.129 & 0.001 \tabularnewline
\hline
\end{tabular}
\caption{APIs and Errors}
\label{table:ApisAndErrors}
\end{table*}


\section{Machine Learning}

We have developed a script infofeatures.py with our datasets to analyze data about features.
The datasets used in this experiment was retrieved from official datasets from national statistical
institutions in Spain, Uruguay, United Kingdom, USA. The features used are: first letter, last letter, [a-z], vocals, consonants, first letter, first letter vocal, last letter vocal, last letter consonant, last letter a. 
The choosing of features was verified with Principal Component Analysis.
The most relevant results for the different datasets are offered in Table~\ref{table:InfoFeatures}.

\begin{table*}
\footnotesize
\begin{tabular}[]{lrrrrrrr}
  \hline
Dataset & a & last a & last o & last consonant & last vocal & 1st consonant & 1st vocal  \tabularnewline
  \hline
  %\endhead
 Uruguay (F) \footnote{F is for females and M is for males} &    0.816 &         0.456 &         0.007 &                 0.287 &             0.712 &                  0.823 &              0.177  \tabularnewline
 Uruguay (M) \footnotemark[3] &    0.643 &         0.249 &         0.062 &                 0.766 &             0.234 &                  0.771 &              0.228  \tabularnewline
 Spain (F) \footnotemark[3]  &    0.922 &         0.588 &          0.03 &                 0.271 &             0.728 &                  0.772 &              0.228  \tabularnewline
 Spain (M) \footnotemark[3]  &    0.818 &          0.03 &         0.268 &                 0.569 &              0.43 &                  0.763 &              0.236  \tabularnewline
 UK (F) \footnotemark[3]     &    0.825 &         0.374 &         0.013 &                 0.322 &             0.674 &                  0.765 &              0.235  \tabularnewline
 UK (M) \footnotemark[3]     &    0.716 &         0.036 &         0.039 &                  0.78 &             0.218 &                  0.799 &                0.2  \tabularnewline
 USA (F) \footnotemark[3]    &    0.816 &         0.456 &         0.007 &                 0.287 &             0.712 &                  0.823 &              0.177  \tabularnewline
 USA (M) \footnotemark[3]    &    0.643 &          0.02 &         0.061 &                 0.765 &             0.234 &                   0.84 &              0.159  \tabularnewline
\hline
\end{tabular}
\caption{Informative Features in Different Countries}
\label{table:InfoFeatures}
\end{table*}

The countries where the main language is Spanish (Uruguay + Spain) and English (USA + United Kingdom + Australia) where is having very similar variation with the features chosen between males and females with these datasets (remember that these datasets are being extracted from official statistics provided by the states). 
In Canada, a country French centric has different rules with this features.

The letter a is varying 0.2 from males to females in (USA and Uruguay) and 0.1 from males to females (United Kingdom, Australia and Spain).
The last letter a is varying 0.5 from males to females in (Australia, Spain) around 0.4 in (USA, United Kingdom) and 0.2 in
Uruguay.
The last letter o from females to males is varying 0.2 in (Spain, Australia) and is equal in (Uruguay, USA, United Kingdom).
For the last letter consonant all countries is giving the result that is for males, with results from 0.2 to 0.5: Uruguay and USA (0.5), United Kingdom (0.4), Australia and Spain (0.3). 
So last letter vocal is reverse than last letter consonant. 
First letter consonant or first letter vocal is a non significant feature due to so similar results in English and Spanish.
The relevant metrics with the different algorithms are shown in Table~\ref{table:MLAccuracies}.

\begin{table}
\footnotesize
\begin{tabular}[]{lcccc}
  \hline
  ML Algorithm & Acc & Prec & F1 & Recall \tabularnewline
  \hline
  %\endhead
 Support Vector Machines             &    0.879 &     0.972 &   0.972 &    1.0  \tabularnewline
 Random Forest                       &    0.862 &     0.902 &   0.902 &    1.0  \tabularnewline
 NLTK (Bayes)                        &    0.862 &     0.902 &   0.902 &    1.0  \tabularnewline
 Multinomial Navie Bayes             &    0.782 &     0.791 &   0.791 &    1.0  \tabularnewline
 Tree                                &    0.764 &     0.821 &   0.796 &    1.0  \tabularnewline
 Stoch. Gradient Distrib.    &    0.709 &     0.943 &   0.815 &    1.0  \tabularnewline
 Gaussian Naive Bayes                &    0.709 &     0.968 &   0.887 &    1.0  \tabularnewline
 Bernoulli Naive Bayes               &    0.699 &     0.965 &   0.816 &    1.0  \tabularnewline
 
\hline
\end{tabular}
\caption{Machine Learning Algorithms and accuracies measures}
\label{table:MLAccuracies}
\end{table}

The results in Table~\ref{table:MLAccuracies} show that using algorithms as Support Vector Machines or Random Forest against a scientific dataset created by independent researchers where it is possible to reach results similar to another commercial solutions about gender detection tools.
Our classifier is binary (only male and female).

We were doing this experiment with NLTK and INE datasets with accuracies reaching accuracies until 0.745.
So it makes sense expect better results in random datasets augmenting languages and countries.
However, our solution is not providing Arabic or Chinese alphabets, yet.

So, it is possible to infer that \texttt{damegender} provides a good solution for nicknames, diminutives, or similar.


\section{Limitations and further research}

In some studies, for example, about Twitter or GitHub, some people can choose between different ways to detect gender (not only names). 
So, we can find gender detection tools from faces in images~\cite{ranjan2017hyperface}, from hand written annotations~\cite{liwicki2011automatic}, or from speeches~\cite{koppel2002automatically}.


The market of gender detection tools is dominated by companies based on payment services through Application Programming Interfaces with good results. 
This market could be modified due to Free Software tools and Open Data giving more explicative results for the user.

Although machine learning techniques are not new in this field, we are giving an approach to guess strings not found in a dataset that currently is classified as unknown and the humans trend to think in gender terms many strings calling it as nicknames or diminutives.

These previous advances in computer science could be giving support to study the gender gap in repositories and mailing lists.
Another future work is to create a free and universal dataset with support for all languages and cultures.



\section*{Acknowledgements}

Here the acknowledgements come...

\bibliographystyle{alpha} 
\bibliography{bibtex}

\end{document}


